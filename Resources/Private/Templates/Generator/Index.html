<f:layout name="Default" />

<f:section name="main">

	<f:flashMessages renderMode="div" />

	{data -> f:debug(maxDepth: 12) -> f:comment()}
	<!-- NoJS Warning! -->
	<noscript><div class="typo3-messages"><div class="typo3-message message-error">ATTENTION: JavaScript needs to be enabled!</div></div></noscript>

	<div class="configurator-index">
		<!-- progress bar/indicator -->
		<progress value="{value.progress}" max="1" id="configurator-progress-value">
			<div class="progress-bar">
				<span><span class="configurator-progress-value-print"><f:format.number decimals="0">{value.progressPercentage}</f:format.number></span>%</span>
			</div>
		</progress>

		<p id="configurator-progress-number"><span class="configurator-progress-value-print"><f:format.number decimals="0">{value.progressPercentage}</f:format.number></span><f:translate id="x_percent_done" /></p>

		<!-- part group navigation -->
		<div id="configurator-part-group-select-index">
			<f:for each="{value.partGroups}" as="partGroup" iteration="partGroupIterator">
				<a data-ccgpg="{partGroup.uid}" id="configurator-part-group-{partGroup.uid}-link" class="configurator-part-group-select configurator-part-group-state-{partGroup.active -> f:format.number(decimals : 0)}{f:if(condition : partGroup.current, then : ' current')}{f:if(condition : partGroup.hidden, then : ' configurator-part-group-hidden')}" title="{partGroup.title}">
					<div>
						<f:if condition="{partGroup.icon}">
							<f:then><f:image src="{partGroup.icon.uid}" id="configurator-part-group-{partGroup.uid}-icon" class="configurator-part-group-icon icon-state-{partGroup.active -> f:format.number(decimals : 0)}{f:if(condition : partGroup.current, then : ' current')}" width="32" height="32" treatIdAsReference="1" /></f:then>
							<f:else><span class="configurator-part-group-number align-center">{partGroupIterator.cycle}</span></f:else>
						</f:if>
						<f:if condition="{partGroup.visible}">
							<f:then><i class="fa fa-{f:if(condition : partGroup.activeParts, then : 'check-', else : '')}square-o"></i></f:then>
							<f:else><i class="fa fa-lock"></i></f:else>
						</f:if>
					</div>
					<div class="hidden-xs hidden-sm configurator-part-group-select-index-title">{partGroup.title}</div>
				</a>
			</f:for>
			<div class="clearfix"></div>
		</div>
		<div id="configurator-part-group-select-part-index">
			<div class="configurator" id="configurator-canvas-main">
				<!-- render part group information -->
				<f:render partial="PartGroup/Info" arguments="{partGroup: value.currentPartGroup}" />
				<div class="clearfix"></div>
				<!-- parse parts; return selectors -->
				<f:render partial="PartGroup/Parts" arguments="{parts: value.currentPartGroup.parts}" />
			<span id="configurator-select-part-group-part-info-hint-box">
				<span class="close-popover-x" title="{f:translate(id:'title.closeIB')}">&times;</span>
				<div></div>
			</span>
			</div>
		</div>
		<div class="clearfix">
			<p></p>
			<f:link.action action="reset" class="btn btn-default {f:if(condition: '{value.progress} <= 0', then: ' disabled')}" noCacheHash="1" id="configurator-reset-configuration-button"><f:translate id="link.reset_configuration" /> &nbsp; <i class="fa fa-undo"></i></f:link.action>
			<f:link.action action="index" class="btn btn-default forward" noCacheHash="1" id="configurator-show-result-button"><f:translate id="link.show_result" /></f:link.action>
		</div>
	</div>

	<hr />

	<!-- render configuration result -->
	<div id="configurator-result-canvas">
		<div class="configurator-result">
			<h3 class="configurator-result-label no-margin"><f:if condition="{configurationLabel}">{configurationLabel}</f:if></h3>
			<h2>
				<f:translate id="index.your_configuration_code" /><br />
				<small class="configurator-result-code"><f:comment><f:render partial="Misc/ConfigurationCode" arguments="{result : configurationCode, type : '{controller -> f:s3b0.substring(endAt:3)}'}" /></f:comment></small>
			</h2>
			<f:link.action action="reset" class="btn btn-default" noCacheHash="1"><f:translate id="link.reset_configuration" /> <i class="fa fa-undo fa-fw"></i></f:link.action>
			<a class="btn btn-default configurator-result-review-config dropdown active" title="{f:translate(id : 'index.summary_button_title')}"><i class="fa fa-bars fa-fw"></i> <f:translate id="index.summary_button" /></a>
			<f:link.action action="request" arguments="{configuration: resultingConfiguration}" id="configurator-request" noCacheHash="1" additionalParams="{L : sys_language_uid}" class="btn btn-default" target="{settings.requestForm.target}"><i class="fa fa-envelope fa-fw"></i> <f:translate id="index.request_your_device" /></f:link.action>
		</div>
		<div id="configurator-summary-table">
			<f:comment><f:render partial="Misc/ConfigurationSummary" arguments="{result : configurationSummary, pricingEnabled: pricingEnabled}" /></f:comment>
		</div>
	</div>

	<script type="text/javascript" language="JavaScript">
		(function($) {
			$(document).ready(function() {
				var $RequestButton = $('#configurator-request'),
					resetTimeout = 40000,
					defaultText = '<i class="fa fa-envelope fa-fw"></i> <f:translate id="index.request_your_device" />',
					loadingText = "{f:translate(id : 'index.request_your_device')}... <i class=\"fa fa-spinner fa-fw fa-pulse\"></i>";
				$RequestButton.attr('data-loading-text', loadingText);

				function resetButton() {
					$RequestButton.removeAttr('disabled').removeClass('disabled').html(defaultText);
				}

				if($RequestButton.hasClass('disabled')) { resetButton(); }
				$RequestButton.on('click', function () {
					$(this).button('loading');
					setTimeout(function() {
						resetButton();
					}, resetTimeout);
				})
			});
		})(jQuery);

		var t3pid = {jsData.pageId},
			t3lang = {jsData.sysLanguage -> f:format.number(decimals: 0)},
			t3cobj = {jsData.contentObject},
			showResult = {f:if(condition: '{configurationData -> f:count()}', then: 'true', else: 'null')},
			moreInfoLinkTitle = "{f:translate(id : 'label.more_information')}",
			js = document.createElement("script");
		js.type = "text/javascript";
		js.src = "{f:uri.resource(path:'JavaScript/main.js')}";
		document.body.appendChild(js);
	</script>

</f:section>